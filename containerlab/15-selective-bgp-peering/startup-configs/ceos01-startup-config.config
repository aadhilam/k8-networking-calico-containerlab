! Arista cEOS startup configuration
!
hostname ceos
!
! Define VLAN 10
!
vlan 10
   name Calico-Network
!
! Configure interfaces as access ports in VLAN 10
! All nodes are connected to VLAN 10, but only worker and worker2 have BGP peering
!
interface Ethernet1
   description Connection to k01-control-plane
   switchport mode access
   switchport access vlan 10
!
interface Ethernet2
   description Connection to k01-worker (BGP Peer)
   switchport mode access
   switchport access vlan 10
!
interface Ethernet3
   description Connection to k01-worker2 (BGP Peer)
   switchport mode access
   switchport access vlan 10
!
interface Ethernet4
   description Connection to k01-worker3
   switchport mode access
   switchport access vlan 10
!
interface Ethernet5
   description Connection to k01-worker4
   switchport mode access
   switchport access vlan 10

!
! Layer 3 interface for VLAN 10
!
interface Vlan10
   description Calico Network L3 Interface
   ip address 10.10.10.1/24
!
! Enable IP routing
!
ip routing
!
! Management interface
!
interface Management0
   ip address dhcp
   no shutdown
!
! User configuration
!
username admin privilege 15 secret admin
!
! Enable HTTP API
!
management api http-commands
   no shutdown

! BGP Configuration
! Note: The ToR accepts BGP connections from the entire subnet, but only nodes
! with the bgp-peer=true label (configured via Calico's nodeSelector) will 
! actually initiate BGP sessions. This is selective peering controlled by Calico.
router bgp 65001
   router-id 10.10.10.1
   bgp listen range 10.10.10.0/24 peer-group CALICO-K8S remote-as 65010
   neighbor CALICO-K8S peer group
   neighbor CALICO-K8S remote-as 65010
   neighbor CALICO-K8S description "Calico Kubernetes Nodes"
   !
   address-family ipv4
      neighbor CALICO-K8S activate
      network 10.10.10.0/24

end

